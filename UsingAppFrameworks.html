<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Richard Clark" />
  <title>Using Web Application Frameworks</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="../reveal.js/css/reveal.min.css"/>
    <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
    </style>
    <link rel="stylesheet" href="../reveal.js/css/theme/simple.css" id="theme">
    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
      if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = '../reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
      }
    </script>
    <!--[if lt IE 9]>
    <script src="../reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->
    <!-- Override the reveal.js styles -->
    <style type="text/css">
    	.reveal h1 { font-size: 2.00em; -webkit-hyphens: none; -moz-hyphens: none; }
    	.reveal h2 { font-size: 1.50em; -webkit-hyphens: none; -moz-hyphens: none; }
    </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Using Web Application Frameworks</h1>
    <h2 class="author">Richard Clark</h2>
    <h3 class="date"></h3>
</section>

<section><section id="single-page-applications" class="titleslide slide level1"><h1>Single-Page Applications</h1></section><section id="a-trivial-spa" class="slide level2">
<h1>A trivial SPA</h1>
<p><a href="./examples/1.1-trivial-spa.html">Demo here</a></p>
</section><section id="a-trivial-spa-html" class="slide level2">
<h1>A trivial SPA (HTML)</h1>
<pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">utf-8</span><span class="kw">&gt;</span>
<span class="kw">&lt;title&gt;</span>A Trivial Single-Page App<span class="kw">&lt;/title&gt;</span>
<span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">request</span><span class="kw">&gt;</span>
Hi there. What is your name? <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> autofocus</span><span class="kw">&gt;</span>
<span class="kw">&lt;/form&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">response</span><span class="ot"> style=</span><span class="st">&quot;display:none&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;template</span><span class="ot"> style=</span><span class="st">&quot;display:none&quot;</span><span class="kw">&gt;</span>Welcome, {name}!<span class="kw">&lt;/template&gt;</span>
<span class="kw">&lt;script&gt;</span>
<span class="co">// See next slide</span>
<span class="kw">&lt;/script&gt;</span></code></pre>
</section><section id="a-trivial-spa-script" class="slide level2">
<h1>A Trivial SPA (script)</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript">(<span class="kw">function</span>() {
  <span class="ot">document</span>.<span class="fu">forms</span>[<span class="dv">0</span>].<span class="fu">onsubmit</span> = <span class="kw">function</span> (event) {
    <span class="kw">var</span> text = <span class="ot">event</span>.<span class="ot">target</span>.<span class="fu">elements</span>[<span class="dv">0</span>].<span class="ot">value</span>.<span class="fu">trim</span>();
    <span class="kw">if</span> (text) {
      <span class="kw">var</span> template = <span class="ot">document</span>.<span class="fu">querySelector</span>(<span class="st">&#39;template&#39;</span>).<span class="fu">innerHTML</span>;
      <span class="kw">var</span> message = <span class="ot">template</span>.<span class="fu">replace</span>(<span class="ot">/{name}/</span>, text);
      <span class="kw">var</span> responsePage = <span class="ot">document</span>.<span class="fu">querySelector</span>(<span class="st">&#39;#response&#39;</span>);
      <span class="ot">responsePage</span>.<span class="fu">innerHTML</span> = message;
      <span class="ot">responsePage</span>.<span class="ot">style</span>.<span class="fu">display</span> = <span class="st">&#39;block&#39;</span>;
      <span class="ot">event</span>.<span class="ot">target</span>.<span class="ot">style</span>.<span class="fu">display</span> = <span class="st">&#39;none&#39;</span>;
    }
    <span class="ot">event</span>.<span class="fu">preventDefault</span>();
  }  
})()</code></pre>
</section></section>
<section><section id="key-concepts" class="titleslide slide level1"><h1>Key Concepts</h1></section><section id="three-things" class="slide level2">
<h1>Three things</h1>
<ol type="1">
<li class="fragment">Multiple screens in one page</li>
<li class="fragment">Content templates</li>
<li class="fragment">Routing and History</li>
</ol>
</section><section id="multiple-screens-in-a-page" class="slide level2">
<h1>Multiple Screens in a Page</h1>
<pre class="sourceCode html"><code class="sourceCode html"><span class="co">&lt;!-- Screen 1 --&gt;</span>
<span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">request</span><span class="kw">&gt;</span>
Hi there. What is your name? <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="kw">&gt;</span>
<span class="kw">&lt;/form&gt;</span>

<span class="co">&lt;!-- Screen 2 --&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">response</span><span class="ot"> style=</span><span class="st">&quot;display:none&quot;</span> <span class="kw">/&gt;</span></code></pre>
</section><section id="multiple-screens-in-a-page-1" class="slide level2">
<h1>Multiple Screens in a Page</h1>
<ul>
<li class="fragment">Block-level elements</li>
<li class="fragment">Control visibility via CSS
<ul>
<li class="fragment">(Often by adding or removing a class)</li>
<li class="fragment"><code>screen.classList.add('current')</code></li>
<li class="fragment"><code>screen.classList.remove('current')</code></li>
</ul></li>
</ul>
</section><section id="practice-1" class="slide level2">
<h1>Practice (1)</h1>
<p>Identify the screens in this page. What are your options for showing and hiding?</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">utf-8</span><span class="kw">&gt;</span>
<span class="kw">&lt;title&gt;</span>A Trivial Single-Page App<span class="kw">&lt;/title&gt;</span>
<span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">request</span><span class="kw">&gt;</span>
Hi there. What is your name? <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> autofocus</span><span class="kw">&gt;</span>
<span class="kw">&lt;/form&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">response</span><span class="ot"> style=</span><span class="st">&quot;display:none&quot;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;template</span><span class="ot"> style=</span><span class="st">&quot;display:none&quot;</span><span class="kw">&gt;</span>Welcome, {name}!<span class="kw">&lt;/template&gt;</span>
<span class="kw">&lt;script&gt;</span>
<span class="co">// See next slide</span>
<span class="kw">&lt;/script&gt;</span></code></pre>
</section><section id="practice-2" class="slide level2">
<h1>Practice (2)</h1>
<p>Explain what this code is doing</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">(<span class="kw">function</span>() {
  <span class="ot">document</span>.<span class="fu">forms</span>[<span class="dv">0</span>].<span class="fu">onsubmit</span> = <span class="kw">function</span> (event) {
  <span class="kw">var</span> text = <span class="ot">event</span>.<span class="ot">target</span>.<span class="fu">elements</span>[<span class="dv">0</span>].<span class="ot">value</span>.<span class="fu">trim</span>();
  <span class="kw">if</span> (text) {
    <span class="kw">var</span> template = <span class="ot">document</span>.<span class="fu">querySelector</span>(<span class="st">&#39;template&#39;</span>).<span class="fu">innerHTML</span>;
    <span class="kw">var</span> message = <span class="ot">template</span>.<span class="fu">replace</span>(<span class="ot">/{name}/</span>, text);
    <span class="kw">var</span> responsePage = <span class="ot">document</span>.<span class="fu">querySelector</span>(<span class="st">&#39;#response&#39;</span>);
    <span class="ot">responsePage</span>.<span class="fu">innerHTML</span> = message;
    <span class="ot">responsePage</span>.<span class="ot">style</span>.<span class="fu">display</span> = <span class="st">&#39;block&#39;</span>;
    <span class="ot">event</span>.<span class="ot">target</span>.<span class="ot">style</span>.<span class="fu">display</span> = <span class="st">&#39;none&#39;</span>;
  }
  <span class="ot">event</span>.<span class="fu">preventDefault</span>();
  }  
})()</code></pre>
</section><section id="practice-3" class="slide level2">
<h1>Practice (3)</h1>
<ol type="1">
<li>Run <a href="./examples/1.1-trivial-spa.html">1.1-trivial-spa.html</a></li>
<li>Implement a &quot;back to the first&quot; page link</li>
</ol>
</section></section>
<section><section id="templating" class="titleslide slide level1"><h1>Templating</h1></section><section id="logic-less-style" class="slide level2">
<h1>&quot;Logic-less&quot; style</h1>
<ul>
<li>Uses named placeholders
<ul>
<li><a href="http://akdubya.github.io/dustjs/">dust.js</a>: <code>Hello, my name is {name}</code></li>
<li><a href="https://github.com/janl/mustache.js">Mustache JS</a>: <code>Hello, my name is {{name.first}}</code></li>
</ul></li>
<li>Special constructs for lists: <code>{#names} Name: {first} Last:{last}   {/names}</code></li>
</ul>
</section><section id="with-embedded-logic" class="slide level2">
<h1>With embedded logic</h1>
<p>JSP/ERB style - <a href="http://documentcloud.github.io/underscore/#template">underscore.js</a>: <code>Hello, my name is &lt;%- name %&gt;</code></p>
</section><section id="how-templates-work" class="slide level2">
<h1>How templates work</h1>
<ol type="1">
<li class="fragment">Define template in a hidden HTML element (e.g. &lt;script&gt; or &lt;template&gt;)</li>
<li class="fragment">Load with template library → compiled function</li>
<li class="fragment">Call function with a JS object</li>
</ol>
</section><section id="templated-spa-html" class="slide level2">
<h1>Templated SPA (HTML)</h1>
<pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">utf-8</span><span class="kw">&gt;</span>
<span class="kw">&lt;title&gt;</span>A Trivial Single-Page App<span class="kw">&lt;/title&gt;</span>
<span class="kw">&lt;style&gt;</span>
  <span class="fl">.current</span>  <span class="kw">{</span> <span class="kw">display:</span> <span class="dt">block</span> <span class="kw">}</span>
  form, div <span class="kw">{</span> <span class="kw">display:</span> <span class="dt">none</span> <span class="kw">}</span>
<span class="kw">&lt;/style&gt;</span>

<span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">request</span><span class="ot"> class=</span><span class="st">&quot;current&quot;</span><span class="kw">&gt;</span>
Hi there. What is your name? <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> autofocus</span><span class="kw">&gt;</span>
<span class="kw">&lt;/form&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">response</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;lib/underscore.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script&gt;</span><span class="co">/* Next slide */</span><span class="kw">&lt;/script&gt;</span></code></pre>
</section><section id="templated-spa-script" class="slide level2">
<h1>Templated SPA (script)</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">window</span>.<span class="fu">onload</span> = <span class="kw">function</span>() {
  <span class="kw">var</span> compiled = <span class="ot">_</span>.<span class="fu">template</span>(<span class="st">&quot;Welcome, &lt;%- name %&gt;!&quot;</span>);
  <span class="kw">var</span> responsePage = <span class="ot">document</span>.<span class="fu">querySelector</span>(<span class="st">&#39;#response&#39;</span>);

  <span class="ot">document</span>.<span class="fu">forms</span>[<span class="dv">0</span>].<span class="fu">onsubmit</span> = <span class="kw">function</span> (event) {
    <span class="kw">var</span> text = <span class="ot">event</span>.<span class="ot">target</span>.<span class="fu">elements</span>[<span class="dv">0</span>].<span class="ot">value</span>.<span class="fu">trim</span>();
    <span class="kw">if</span> (text) {
      <span class="ot">responsePage</span>.<span class="fu">innerHTML</span> = <span class="fu">compiled</span>({<span class="dt">name</span>:(text)});
      <span class="ot">responsePage</span>.<span class="ot">classList</span>.<span class="fu">add</span>(<span class="st">&#39;current&#39;</span>);
      <span class="ot">event</span>.<span class="ot">target</span>.<span class="ot">classList</span>.<span class="fu">remove</span>(<span class="st">&#39;current&#39;</span>);
    }
    <span class="ot">event</span>.<span class="fu">preventDefault</span>();
  }
}</code></pre>
</section><section id="practice" class="slide level2">
<h1>Practice</h1>
<ol type="1">
<li>Create a simple &quot;hello world&quot; app using an <a href="http://documentcloud.github.io/underscore/#template">underscore.js</a> template.</li>
<li>Merge some data into the template and add to the page.</li>
<li>Create an array and render all the elements.</li>
<li>Render nested objects.</li>
<li>(Extra) Try with a logic-less library such as <a href="http://akdubya.github.io/dustjs/">dust.js</a></li>
</ol>
</section></section>
<section><section id="routing-and-history" class="titleslide slide level1"><h1>Routing and History</h1></section><section id="the-challenge-with-urls" class="slide level2">
<h1>The challenge with URLs</h1>
<ul>
<li class="fragment">Unique URLs typically map to unique content
<ul>
<li class="fragment">Different pages</li>
<li class="fragment">Fragments within a page: <code>page#named-link</code></li>
<li class="fragment">RESTful APIs: <code>/shop/shoes/mens/dress/</code> ...</li>
</ul></li>
<li class="fragment">People want to bookmark</li>
<li class="fragment">Search engines want to link</li>
</ul>
</section><section id="urls-and-spas" class="slide level2">
<h1>URLs and SPAs</h1>
<ul>
<li class="fragment">Make URLs map to states in the app (<em>Routing</em>)
<ul>
<li class="fragment"><code>page?state=1</code> vs. <code>page#state1</code></li>
</ul></li>
<li class="fragment">When state changes, update the URL</li>
<li class="fragment">Track URL changes to set state</li>
</ul>
</section><section id="vs" class="slide level2">
<h1># vs #!</h1>
<ul>
<li class="fragment">Content after <code>#</code> is the <em>fragment identifier</em></li>
<li class="fragment"><a href="http://googlewebmastercentral.blogspot.com/2009/10/proposal-for-making-ajax-crawlable.html">Google proposed</a> <code>#!</code> to designate bookmarkable URLs</li>
</ul>
</section><section id="updating-the-url" class="slide level2">
<h1>Updating the URL</h1>
<ul>
<li class="fragment"><code>window.location</code> or <code>window.location.hash</code> (preferred)</li>
<li class="fragment"><code>window.pushState(data, description, url)</code> (HTML5)</li>
<li class="fragment"><code>window.replaceState(data, description, url)</code> (HTML5)</li>
</ul>
</section><section id="capturing-url-changes" class="slide level2">
<h1>Capturing URL changes</h1>
<ul>
<li class="fragment">hashchange
<ul>
<li class="fragment">`window.onhashchange = function() {</li>
<li class="fragment"><code>// use window.location.hash...</code></li>
</ul></li>
<li class="fragment">Works on old browsers, even IE</li>
<li class="fragment">Useful library: <a href="http://benalman.com/projects/jquery-bbq-plugin/">jQuery BBQ</a></li>
</ul>
</section><section id="the-history-api" class="slide level2">
<h1>The History API</h1>
<ul>
<li class="fragment">Added in HTML5</li>
<li class="fragment">Adds state objects &amp; descriptions to browser history</li>
</ul>
</section><section id="the-history-api-1" class="slide level2">
<h1>The History API</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">interface</span> History {
  readonly attribute long length;
  readonly attribute any state;
  <span class="kw">void</span> <span class="fu">go</span>(optional long delta);
  <span class="kw">void</span> <span class="fu">back</span>();
  <span class="kw">void</span> <span class="fu">forward</span>();
  <span class="kw">void</span> <span class="fu">pushState</span>(any data, DOMString title, optional DOMString? url = <span class="kw">null</span>);
  <span class="kw">void</span> <span class="fu">replaceState</span>(any data, DOMString title, optional DOMString? url = <span class="kw">null</span>);
};</code></pre>
</section><section id="tracking-history-changes" class="slide level2">
<h1>Tracking history changes</h1>
<ul>
<li class="fragment">popstate
<ul>
<li class="fragment">Event fired for history forward/back (if using pushState/replacreState)</li>
<li class="fragment"><code>event.state</code> = passed-in state object</li>
</ul></li>
</ul>
</section><section id="history-api-gotchas" class="slide level2">
<h1>History API gotchas</h1>
<ul>
<li class="fragment">Some browsers fire popstate on page load, others don't</li>
<li class="fragment">Most browsers ignore title string</li>
<li class="fragment">Can only set url for http/https pages</li>
</ul>
</section><section id="history-api-example" class="slide level2">
<h1>History API example</h1>
<ul>
<li class="fragment"><a href="./examples/1.4.canvas-star-polygon.html">Star Polygons</a></li>
</ul>
</section><section id="history-api-example-1" class="slide level2">
<h1>History API example</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="fu">getValueObject</span>() {
  <span class="kw">var</span> sides = <span class="fu">parseInt</span>(<span class="ot">sidesCtl</span>.<span class="fu">value</span>);
  <span class="kw">var</span> skip = <span class="fu">parseInt</span>(<span class="ot">skipCtl</span>.<span class="fu">value</span>);
  <span class="kw">return</span> {<span class="dt">sides</span>:(sides), <span class="dt">skip</span>:(skip)};
}

<span class="ot">document</span>.<span class="fu">onchange</span> = <span class="kw">function</span>(evt) {
  <span class="kw">var</span> values = <span class="fu">getValueObject</span>(); <span class="co">// ex: {sides:3, skip:1}</span>
  <span class="ot">window</span>.<span class="ot">history</span>.<span class="fu">pushState</span>(values);
  <span class="fu">draw</span>(values);
}

<span class="ot">window</span>.<span class="fu">onpopstate</span> = <span class="kw">function</span> (event) {
  <span class="fu">draw</span>(<span class="ot">event</span>.<span class="fu">state</span>);
}

<span class="co">// First time</span>
<span class="ot">window</span>.<span class="fu">onload</span> = <span class="kw">function</span>() {
  <span class="kw">var</span> values = <span class="fu">getValueObject</span>();
  <span class="ot">window</span>.<span class="ot">history</span>.<span class="fu">replaceState</span>(values);
  <span class="fu">draw</span>(values);
}</code></pre>
</section><section id="practice-4" class="slide level2">
<h1>Practice</h1>
<ol type="1">
<li>Add history tracking to your simple two-page SPA (a fragment ID for each screen)</li>
<li>Can you implement bookmarks with the user's name?</li>
</ol>
</section></section>
<section><section id="spas-via-backbone.js" class="titleslide slide level1"><h1>SPAs via backbone.js</h1></section><section id="backbone.js" class="slide level2">
<h1>backbone.js</h1>
<ul>
<li class="fragment">Basic framework for building SPAs
<ul>
<li class="fragment">View rendering</li>
<li class="fragment">Routing</li>
<li class="fragment">Events</li>
<li class="fragment">History management</li>
<li class="fragment">Networking (via REST &amp; JSON)</li>
<li class="fragment">Model-View-Controller structure</li>
</ul></li>
<li class="fragment">Nice <a href="https://github.com/jashkenas/backbone/wiki/Extensions%2C-Plugins%2C-Resources">collection of plugins and tools</a></li>
<li class="fragment">Good entry point for more complex frameworks (e.g. AngularJS)</li>
</ul>
</section><section id="our-first-example-in-backbone-html" class="slide level2">
<h1>Our first example, in Backbone (HTML)</h1>
<pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span>
<span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">utf-8</span><span class="kw">&gt;</span>
<span class="kw">&lt;title&gt;</span>A Trivial Single-Page App<span class="kw">&lt;/title&gt;</span>

<span class="kw">&lt;main</span><span class="ot"> id=</span><span class="st">&quot;helloapp&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">request</span><span class="kw">&gt;</span>
  Hi there. What is your name? <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="st">&quot;name&quot;</span><span class="ot"> type=</span><span class="st">text</span><span class="ot"> autofocus</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/form&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">response</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;/main&gt;</span>

<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;lib/underscore.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;lib/zepto.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;lib/backbone.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
<span class="kw">&lt;script&gt;</span><span class="co">/* Next slide */</span><span class="kw">&lt;/script&gt;</span></code></pre>
</section><section id="our-first-example-in-backbone-js" class="slide level2">
<h1>Our first example, in Backbone (JS)</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="fu">$</span>(<span class="kw">function</span>() {

  <span class="kw">var</span> AppView = <span class="ot">Backbone</span>.<span class="ot">View</span>.<span class="fu">extend</span>({

    <span class="dt">el</span>: <span class="fu">$</span>(<span class="st">&#39;#helloapp&#39;</span>),

    <span class="dt">events</span>: {
      <span class="st">&quot;submit&quot;</span>: <span class="st">&quot;sayHello&quot;</span>
    },

    <span class="dt">initialize</span>: <span class="kw">function</span>() {
      <span class="kw">this</span>.<span class="fu">form</span> = <span class="fu">$</span>(<span class="st">&#39;#request&#39;</span>);
      <span class="kw">this</span>.<span class="fu">input</span> = <span class="fu">$</span>(<span class="st">&#39;#name&#39;</span>);
    },

    <span class="dt">sayHello</span>: <span class="kw">function</span>(event) {
      <span class="fu">$</span>(<span class="st">&#39;#response&#39;</span>).<span class="fu">html</span>(<span class="st">&quot;Hello, &quot;</span> + <span class="kw">this</span>.<span class="ot">input</span>.<span class="fu">val</span>());
      <span class="kw">this</span>.<span class="ot">form</span>.<span class="fu">hide</span>();
      <span class="ot">event</span>.<span class="fu">preventDefault</span>();
    },
  });

  <span class="co">// Starts the app</span>
  <span class="kw">new</span> AppView;

})</code></pre>
</section><section id="mvc-in-backbone" class="slide level2">
<h1>MVC in Backbone</h1>
<ul>
<li>Model-View-Controller
<ul>
<li>Model: The information to be displayed</li>
<li>View: How it's displayed (templates)</li>
<li>Controller: The code that links these</li>
</ul></li>
</ul>
</section><section id="the-model" class="slide level2">
<h1>The Model</h1>
<ul>
<li class="fragment">Subclass of Backbone.Model
<ul>
<li class="fragment"><code>var Stock = Backbone.Model.extend({ ...})</code></li>
<li class="fragment">&quot;Frequently representing a row of data on your server&quot; per <a href="http://backbonejs.org/docs/backbone.html">annotated source</a></li>
</ul></li>
<li class="fragment">Emits <code>change</code> event on change</li>
<li class="fragment">Paired with a View for rendering</li>
</ul>
</section><section id="example-model" class="slide level2">
<h1>Example model</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> Stock = <span class="ot">Backbone</span>.<span class="ot">Model</span>.<span class="fu">extend</span>({
  <span class="co">// typical data: {ticker: &quot;AAPL&quot;, company: &quot;Apple&quot;, price: 123.45}</span>
  <span class="dt">idAttribute</span>: <span class="st">&#39;ticker&#39;</span>,

  <span class="dt">lastPrice</span>: <span class="kw">null</span>,

  <span class="dt">initialize</span>: <span class="kw">function</span> () {
      <span class="kw">this</span>.<span class="ot">attributes</span>.<span class="fu">change</span> = <span class="st">&#39;&#39;</span>;
      <span class="kw">this</span>.<span class="fu">lastPrice</span> = <span class="kw">null</span>;
      <span class="kw">this</span>.<span class="fu">on</span>(<span class="st">&#39;change&#39;</span>, <span class="kw">this</span>.<span class="fu">onChange</span>, <span class="kw">this</span>);
  },

  <span class="dt">onChange</span>: <span class="kw">function</span> () {
      <span class="kw">var</span> price = <span class="kw">this</span>.<span class="ot">attributes</span>.<span class="fu">price</span>;
      <span class="kw">if</span> (<span class="kw">this</span>.<span class="fu">lastPrice</span>) <span class="kw">this</span>.<span class="ot">attributes</span>.<span class="fu">change</span> = price - <span class="kw">this</span>.<span class="fu">lastPrice</span>;
      <span class="kw">this</span>.<span class="fu">lastPrice</span> = price;
  }

});</code></pre>
</section><section id="collections-hold-multiple-models" class="slide level2">
<h1>Collections hold multiple models</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> StockCollection = <span class="ot">Backbone</span>.<span class="ot">Collection</span>.<span class="fu">extend</span>({

  <span class="co">// Reference to this collection&#39;s model.</span>
  <span class="dt">model</span>: Stock,

  <span class="co">// Sort by name</span>
  <span class="dt">comparator</span>: <span class="st">&#39;company&#39;</span>

});</code></pre>
</section><section id="views-render-models-collections" class="slide level2">
<h1>Views render Models &amp; Collections</h1>
<ul>
<li class="fragment">Subclass of Backbone.View
<ul>
<li class="fragment"><code>var StockView = Backbone.View.extend({ ... })</code></li>
<li class="fragment">Listen for events from model (<code>change</code>) or collection (<code>add</code>, <code>remove</code>, <code>change</code>)</li>
</ul></li>
</ul>
</section><section id="html-to-contain-view" class="slide level2">
<h1>HTML to contain view</h1>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;stockapp&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;header&gt;</span>
        <span class="kw">&lt;h1&gt;</span>Stock Ticker using JMS and Backbone<span class="kw">&lt;/h1&gt;</span>
    <span class="kw">&lt;/header&gt;</span>
    <span class="kw">&lt;table</span><span class="ot"> id=</span><span class="st">&quot;stocks&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;thead&gt;</span>
        <span class="kw">&lt;tr&gt;</span>
            <span class="kw">&lt;th&gt;</span>Company<span class="kw">&lt;/th&gt;</span>
            <span class="kw">&lt;th&gt;</span>Symbol<span class="kw">&lt;/th&gt;</span>
            <span class="kw">&lt;th&gt;</span>Price<span class="kw">&lt;/th&gt;</span>
            <span class="kw">&lt;th&gt;</span>Change<span class="kw">&lt;/th&gt;</span>
        <span class="kw">&lt;/tr&gt;</span>
        <span class="kw">&lt;/thead&gt;</span>
        <span class="kw">&lt;tbody&gt;</span>
        <span class="co">&lt;!-- Stocks will go here --&gt;</span>
        <span class="kw">&lt;/tbody&gt;</span>
    <span class="kw">&lt;/table&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre>
</section><section id="view-template-underscore" class="slide level2">
<h1>View template (underscore)</h1>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id=</span><span class="st">&quot;stock-template&quot;</span><span class="kw">&gt;</span>
  &lt;td&gt;&lt;%- company %&gt;&lt;<span class="ot">/td&gt;</span>
<span class="ot">  &lt;td&gt;&lt;%- symbol %&gt;&lt;/td</span>&gt;
  &lt;td&gt;$&lt;%= <span class="ot">price</span>.<span class="fu">toFixed</span>(<span class="dv">2</span>) %&gt;&lt;<span class="ot">/td&gt;</span>
<span class="ot">  &lt;td&gt;$&lt;%= change.toFixed</span><span class="fl">(</span><span class="ot">2</span><span class="fl">)</span><span class="ot"> %&gt;&lt;/td</span>&gt;
&lt;<span class="ot">/script&gt;</span></code></pre>
</section><section id="view-code" class="slide level2">
<h1>View code</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The DOM element for a Stock...</span>
<span class="kw">var</span> StockView = <span class="ot">Backbone</span>.<span class="ot">View</span>.<span class="fu">extend</span>({
  <span class="co">//... is a table row.</span>
  <span class="dt">tagName</span>: <span class="st">&#39;tr&#39;</span>,

  <span class="dt">className</span>: <span class="st">&#39;stock&#39;</span>,

  <span class="co">// Cache the template function for a single item.</span>
  <span class="dt">template</span>: <span class="ot">_</span>.<span class="fu">template</span>(<span class="fu">$</span>(<span class="st">&#39;#stock-template&#39;</span>).<span class="fu">html</span>()),

  <span class="co">// The StockView listens for changes to its model, re-rendering.</span>
  <span class="dt">initialize</span>: <span class="kw">function</span> () {
      <span class="kw">this</span>.<span class="fu">listenTo</span>(<span class="kw">this</span>.<span class="fu">model</span>, <span class="st">&#39;change&#39;</span>, <span class="kw">this</span>.<span class="fu">render</span>);
  },

  <span class="co">// Rebuild the table row.</span>
  <span class="dt">render</span>: <span class="kw">function</span> () {
      <span class="kw">this</span>.<span class="ot">$el</span>.<span class="fu">html</span>(<span class="kw">this</span>.<span class="fu">template</span>(<span class="kw">this</span>.<span class="ot">model</span>.<span class="fu">toJSON</span>()));
      <span class="kw">return</span> <span class="kw">this</span>;
  }
});</code></pre>
</section><section id="rendering-the-collection" class="slide level2">
<h1>Rendering the collection</h1>
<p>Wrap the table in a template</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/template&quot;</span><span class="ot"> id=</span><span class="st">&quot;portfolio-template&quot;</span><span class="kw">&gt;</span>
  &lt;table&gt;
      &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Company&lt;<span class="ot">/th&gt;</span>
<span class="ot">          &lt;th&gt;Symbol&lt;/th</span>&gt;
          &lt;th&gt;Price&lt;<span class="ot">/th&gt;</span>
<span class="ot">          &lt;th&gt;Change&lt;/th</span>&gt;
      &lt;<span class="ot">/tr&gt;</span>
<span class="ot">      &lt;/thead</span>&gt;
      &lt;tbody&gt;
      &lt;!-- Stocks will go here --&gt;
      &lt;<span class="ot">/tbody&gt;</span>
<span class="ot">  &lt;/table</span>&gt;
&lt;<span class="ot">/script&gt;</span></code></pre>
</section><section id="rendering-the-collection-1" class="slide level2">
<h1>Rendering the collection</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> StockCollectionView = <span class="ot">Backbone</span>.<span class="ot">View</span>.<span class="fu">extend</span>({

  <span class="dt">tagName</span>: <span class="st">&quot;table&quot;</span>,

  <span class="co">// Cache the template function for a single item.</span>
  <span class="dt">template</span>: <span class="ot">_</span>.<span class="fu">template</span>(<span class="fu">$</span>(<span class="st">&#39;#portfolio-template&#39;</span>).<span class="fu">html</span>()),

  <span class="dt">subviews</span>: [],

  <span class="dt">initialize</span>: <span class="kw">function</span> () {
      <span class="kw">this</span>.<span class="fu">subviews</span> = [];
      <span class="kw">this</span>.<span class="ot">$el</span>.<span class="fu">html</span>(<span class="kw">this</span>.<span class="fu">template</span>());
      <span class="kw">this</span>.<span class="ot">collection</span>.<span class="fu">on</span>(<span class="st">&#39;add&#39;</span>, <span class="kw">this</span>.<span class="fu">added</span>, <span class="kw">this</span>);
  },

  <span class="dt">added</span>: <span class="kw">function</span> (stock) {
      <span class="kw">var</span> index = <span class="kw">this</span>.<span class="ot">collection</span>.<span class="ot">models</span>.<span class="fu">indexOf</span>(stock);
      <span class="kw">var</span> subview = <span class="kw">new</span> <span class="fu">StockView</span>({<span class="dt">model</span>: stock});
      <span class="kw">var</span> html = <span class="ot">subview</span>.<span class="fu">render</span>().<span class="fu">$el</span>;
      <span class="co">// Patch the DOM directly to avoid removing and rebuilding the whole table</span>
      <span class="kw">if</span> (index == <span class="kw">this</span>.<span class="ot">subviews</span>.<span class="fu">length</span>) {
          <span class="kw">this</span>.<span class="ot">$el</span>.<span class="fu">find</span>(<span class="st">&#39;tbody&#39;</span>).<span class="fu">append</span>(html);
      } <span class="kw">else</span> {
          <span class="kw">this</span>.<span class="fu">subviews</span>[index].<span class="ot">$el</span>.<span class="fu">before</span>(html);
      }
      <span class="kw">this</span>.<span class="ot">subviews</span>.<span class="fu">splice</span>(index, <span class="dv">0</span>, subview);
  },

  <span class="dt">render</span>: <span class="kw">function</span> () {
      <span class="kw">return</span> <span class="kw">this</span>;
  }
});</code></pre>
</section><section id="the-controller" class="slide level2">
<h1>The Controller</h1>
<ul>
<li class="fragment">Not a separate class</li>
<li class="fragment">Implemented as event listeners in the view (typically the application view)</li>
</ul>
</section><section id="app-view-code" class="slide level2">
<h1>App view code</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> AppView = <span class="ot">Backbone</span>.<span class="ot">View</span>.<span class="fu">extend</span>({
  <span class="dt">el</span>: <span class="fu">$</span>(<span class="st">&quot;#stockapp&quot;</span>), <span class="co">// bind to existing in HTML</span>

  <span class="dt">initialize</span>: <span class="kw">function</span> () {
      <span class="kw">var</span> stockTable = <span class="kw">this</span>.<span class="ot">$el</span>.<span class="fu">find</span>(<span class="st">&#39;#stocks&#39;</span>);
      <span class="kw">var</span> newTable = <span class="ot">PortfolioView</span>.<span class="fu">render</span>().<span class="fu">el</span>;
      <span class="ot">stockTable</span>.<span class="fu">html</span>(newTable);

      <span class="ot">Portfolio</span>.<span class="fu">on</span>(<span class="st">&#39;add remove&#39;</span>, <span class="kw">this</span>.<span class="fu">render</span>, <span class="kw">this</span>);
  },

  <span class="dt">render</span>: <span class="kw">function</span> () {
      <span class="ot">PortfolioView</span>.<span class="fu">render</span>();
      <span class="kw">return</span> <span class="kw">this</span>;
  }
});

<span class="kw">var</span> App = <span class="kw">new</span> AppView;</code></pre>
</section><section id="extra-adding-real-time-data" class="slide level2">
<h1>Extra: Adding real-time data</h1>
<ul>
<li class="fragment">Backbone assumes a REST model
<ul>
<li class="fragment">User actions trigger a GET/PUT/POST</li>
<li class="fragment">e.g. adding a TODO item</li>
</ul></li>
<li class="fragment">Add a data source:
<ul>
<li class="fragment">Listen for incoming messages (Comet, WebSockets)</li>
<li class="fragment">Emit an event for each</li>
<li class="fragment">Controller code parses data, merges into model</li>
</ul></li>
</ul>
</section><section id="real-time-data-via-kaazing-jms" class="slide level2">
<h1>Real-time data via Kaazing JMS</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Router for JMS messages</span>
<span class="kw">var</span> JMSHandler = <span class="kw">function</span> (url) {
    <span class="kw">this</span>.<span class="fu">url</span> = url;
    <span class="kw">this</span>.<span class="fu">connection</span> = <span class="kw">null</span>;
    <span class="kw">this</span>.<span class="fu">session</span> = <span class="kw">null</span>;
}

<span class="ot">_</span>.<span class="fu">extend</span>(<span class="ot">JMSHandler</span>.<span class="fu">prototype</span>, <span class="ot">Backbone</span>.<span class="fu">Events</span>, {
    <span class="dt">connection</span>: <span class="kw">null</span>,
    <span class="dt">session</span>: <span class="kw">null</span>,

    <span class="dt">connect</span>: <span class="kw">function</span> () {
        <span class="kw">var</span> factory = <span class="kw">new</span> <span class="fu">JmsConnectionFactory</span>(<span class="kw">this</span>.<span class="fu">url</span>);
        <span class="kw">var</span> self = <span class="kw">this</span>;
        <span class="kw">var</span> future = <span class="ot">factory</span>.<span class="fu">createConnection</span>(<span class="kw">function</span> () {
            <span class="kw">try</span> {
                <span class="kw">var</span> connection = <span class="ot">self</span>.<span class="fu">connection</span> = <span class="ot">future</span>.<span class="fu">getValue</span>();
                <span class="kw">var</span> session = <span class="ot">self</span>.<span class="fu">session</span> = <span class="ot">connection</span>.<span class="fu">createSession</span>(<span class="kw">false</span>, <span class="ot">Session</span>.<span class="fu">AUTO_ACKNOWLEDGE</span>);
                <span class="ot">self</span>.<span class="fu">trigger</span>(<span class="st">&#39;sessionReady&#39;</span>, session);
                <span class="ot">connection</span>.<span class="fu">start</span>(<span class="kw">function</span> () {
                  <span class="kw">this</span>.<span class="fu">trigger</span>(<span class="st">&#39;connectionStarted&#39;</span>, connection, session);
                });
            } <span class="kw">catch</span> (e) {
                <span class="fu">alert</span>(<span class="ot">e</span>.<span class="fu">message</span>);
            }
        });
    }
});</code></pre>
</section><section id="processing-the-data" class="slide level2">
<h1>Processing the data</h1>
<p>In AppView</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  initialize: <span class="kw">function</span> () {
      <span class="kw">var</span> stockTable = <span class="kw">this</span>.<span class="ot">$el</span>.<span class="fu">find</span>(<span class="st">&#39;#stocks&#39;</span>);
      <span class="kw">var</span> newTable = <span class="ot">PortfolioView</span>.<span class="fu">render</span>().<span class="fu">el</span>;
      <span class="ot">stockTable</span>.<span class="fu">html</span>(newTable);

      <span class="ot">Portfolio</span>.<span class="fu">on</span>(<span class="st">&#39;add remove&#39;</span>, <span class="kw">this</span>.<span class="fu">render</span>, <span class="kw">this</span>);
      <span class="kw">this</span>.<span class="fu">jms</span> = <span class="kw">new</span> <span class="fu">JMSHandler</span>(<span class="st">&quot;ws://localhost:8000/jms&quot;</span>);
      <span class="kw">this</span>.<span class="ot">jms</span>.<span class="fu">on</span>(<span class="st">&#39;sessionReady&#39;</span>, <span class="kw">this</span>.<span class="fu">onSessionReady</span>, <span class="kw">this</span>);
      <span class="kw">this</span>.<span class="ot">jms</span>.<span class="fu">connect</span>();
  },

  onSessionReady: <span class="kw">function</span> (session) {
      <span class="kw">this</span>.<span class="fu">topic</span> = <span class="ot">session</span>.<span class="fu">createTopic</span>(<span class="st">&quot;/topic/stock&quot;</span>);
      <span class="kw">this</span>.<span class="fu">consumer</span> = <span class="ot">session</span>.<span class="fu">createConsumer</span>(<span class="kw">this</span>.<span class="fu">topic</span>);
      <span class="kw">this</span>.<span class="ot">consumer</span>.<span class="fu">setMessageListener</span>(<span class="kw">this</span>.<span class="fu">onStockMessage</span>);
  },

  onStockMessage: <span class="kw">function</span> (message) {
      <span class="kw">var</span> text = <span class="ot">message</span>.<span class="fu">getText</span>();
      <span class="kw">var</span> attrs = <span class="ot">Stock</span>.<span class="ot">prototype</span>.<span class="fu">parse</span>(text);
      <span class="ot">Portfolio</span>.<span class="fu">add</span>(attrs, {<span class="dt">merge</span>: <span class="kw">true</span>});
  },</code></pre>
</section><section id="parsing-the-message" class="slide level2">
<h1>Parsing the message</h1>
<p>In Stock class</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  <span class="co">// The usual parse function is handed a JSON response and merely returns it.</span>
  <span class="co">// We&#39;re getting a colon-delimited string.</span>
  parse: <span class="kw">function</span> (text) {
      <span class="kw">var</span> a = <span class="ot">text</span>.<span class="fu">split</span>(<span class="st">&#39;:&#39;</span>);
      <span class="kw">return</span> { <span class="dt">company</span>: (a[<span class="dv">0</span>]), <span class="dt">ticker</span>: (a[<span class="dv">1</span>]), <span class="dt">price</span>: (<span class="fu">parseFloat</span>(a[<span class="dv">2</span>])) };
  },</code></pre>
</section><section id="not-discussed" class="slide level2">
<h1>Not discussed</h1>
<ul>
<li class="fragment">Saving via <code>Backbone.sync</code></li>
<li class="fragment">Routing via <code>Backbone.Router</code></li>
<li class="fragment">History management via <code>Backbone.History</code></li>
</ul>
</section><section id="practice-5" class="slide level2">
<h1>Practice</h1>
<ol type="1">
<li>Implement &quot;Hello&quot; SPA using Backbone</li>
<li>Create a page with a button. Show the number of clicks</li>
<li><a href="http://www.geonames.org">Getnames.org</a> implements a search page that returns JSON. Write your own front-end for it.
<ul>
<li>Hint: The <a href="https://github.com/rdclark/neighhborhood">Neighborhood</a> sample app implements this search using jQuery's AJAX support. See <a href="https://github.com/rdclark/neighhborhood/blob/master/js/geo_CORS.js">js/geo_CORS.js</a></li>
</ul></li>
</ol>
</section></section>
<section><section id="extra-javascript-promises" class="titleslide slide level1"><h1>Extra: Javascript Promises</h1></section><section id="promises-simplify-asynchronous-code" class="slide level2">
<h1>Promises simplify asynchronous code</h1>
<p>Before:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="fu">step1</span>(<span class="kw">function</span> (value1) {
    <span class="fu">step2</span>(value1, <span class="kw">function</span>(value2) {
        <span class="fu">step3</span>(value2, <span class="kw">function</span>(value3) {
            <span class="fu">step4</span>(value3, <span class="kw">function</span>(value4) {
                <span class="co">// Do something with value4</span>
            });
        });
    });
});</code></pre>
</section><section id="with-promises-using-q" class="slide level2">
<h1>With promises (using Q)</h1>
<p>Using the <a href="https://github.com/kriskowal/q">Q</a> library</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">Q</span>.<span class="fu">fcall</span>(promisedStep1)
.<span class="fu">then</span>(promisedStep2)
.<span class="fu">then</span>(promisedStep3)
.<span class="fu">then</span>(promisedStep4)
.<span class="fu">then</span>(<span class="kw">function</span> (value4) {
    <span class="co">// Do something with value4</span>
})
.<span class="fu">catch</span>(<span class="kw">function</span> (error) {
    <span class="co">// Handle any error from all above steps</span>
})
.<span class="fu">done</span>();</code></pre>
</section><section id="networking-without-promises" class="slide level2">
<h1>Networking without promises</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> ws = <span class="kw">new</span> <span class="fu">WebSocket</span>(<span class="st">&quot;ws://echo.websocket.org&quot;</span>);
<span class="ot">ws</span>.<span class="fu">onopen</span> = <span class="kw">function</span>() {
  <span class="ot">ws</span>.<span class="fu">send</span>(<span class="st">&quot;I hear an echo&quot;</span>);
}

<span class="ot">ws</span>.<span class="fu">onerror</span> = <span class="kw">function</span>(err) {
  <span class="ot">console</span>.<span class="fu">log</span>(<span class="ot">err</span>.<span class="fu">data</span>);
  <span class="ot">ws</span>.<span class="fu">close</span>();
}

<span class="ot">ws</span>.<span class="fu">onmessage</span> = <span class="kw">function</span>(evt) {
  <span class="ot">console</span>.<span class="fu">log</span>(<span class="ot">evt</span>.<span class="fu">data</span>);
}

<span class="kw">function</span> <span class="fu">send</span>(message) {
  <span class="ot">ws</span>.<span class="fu">send</span>(message):
}</code></pre>
</section><section id="easier-networking-with-promises" class="slide level2">
<h1>Easier networking with promises</h1>
<p>I would like to do this:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  <span class="fu">open</span>(<span class="st">&quot;ws://echo.websocket.org&quot;</span>)
    .<span class="fu">then</span>(<span class="fu">send</span>(<span class="st">&quot;hello, world&quot;</span>))
    .<span class="fu">then</span>(read)
    .<span class="fu">then</span>(print)
    .<span class="fu">catch</span>(<span class="kw">function</span>(error) {
       <span class="ot">console</span>.<span class="fu">log</span>(<span class="st">&quot;ERROR &quot;</span> + error)
     })
    .<span class="fu">finally</span>(close);</code></pre>
</section><section id="wrapping-websocket-in-promises" class="slide level2">
<h1>Wrapping WebSocket in promises</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="fu">open</span>(wsurl) {
  <span class="kw">return</span> <span class="kw">new</span> <span class="ot">Q</span>.<span class="fu">Promise</span>(resolve, reject) {
    <span class="kw">var</span> ws = <span class="kw">new</span> <span class="fu">WebSocket</span>(wsurl);

    <span class="ot">ws</span>.<span class="fu">onopen</span> = <span class="kw">function</span>() {
      <span class="fu">resolve</span>(ws);
    }

    <span class="ot">ws</span>.<span class="fu">onerror</span> = <span class="kw">function</span>(err) {
      <span class="fu">reject</span>(<span class="kw">new</span> <span class="fu">Error</span>(<span class="ot">err</span>.<span class="fu">data</span>));
    }
}</code></pre>
<p>Usage:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  <span class="fu">open</span>(<span class="st">&quot;ws://echo.websocket.org&quot;</span>).<span class="fu">then</span>(...</code></pre>
</section><section id="waiting-for-an-event" class="slide level2">
<h1>Waiting for an event</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="fu">read</span>(ws) {
  <span class="kw">return</span> <span class="kw">new</span> <span class="ot">Q</span>.<span class="fu">Promise</span>(resolve) {

    <span class="ot">ws</span>.<span class="fu">onmessage</span> = <span class="kw">function</span>(evt) {
      <span class="fu">resolve</span>(<span class="ot">evt</span>.<span class="fu">data</span>);
    }
  }
}</code></pre>
</section><section id="utility-functions" class="slide level2">
<h1>Utility functions</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="fu">close</span>(ws) { <span class="ot">ws</span>.<span class="fu">close</span>() };

<span class="kw">function</span> <span class="fu">send</span>(message) <span class="kw">return</span> { <span class="kw">function</span>(ws) { <span class="ot">ws</span>.<span class="fu">send</span>(message); <span class="kw">return</span> ws }};

<span class="kw">function</span> <span class="fu">print</span>(message) {
  <span class="ot">console</span>.<span class="fu">log</span>(message);
}</code></pre>
</section><section id="theres-a-problem" class="slide level2">
<h1>There's a problem</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  <span class="fu">open</span>(<span class="st">&quot;ws://echo.websocket.org&quot;</span>) <span class="co">// returns ws</span>
    .<span class="fu">then</span>(<span class="fu">send</span>(<span class="st">&quot;hello, world&quot;</span>))   <span class="co">// consumes ws, returns ws</span>
    .<span class="fu">then</span>(read)                   <span class="co">// consumes ws, returns string/binary</span>
    .<span class="fu">then</span>(print)                  <span class="co">// consumes string/binary, returns nothing</span>
    .<span class="fu">catch</span>(<span class="kw">function</span>(error) {
       <span class="ot">console</span>.<span class="fu">log</span>(<span class="st">&quot;ERROR &quot;</span> + error)
     })
    .<span class="fu">finally</span>(close);              <span class="co">// consumes ws...which may not be available!</span></code></pre>
</section><section id="one-way-to-resolve-this" class="slide level2">
<h1>One way to resolve this</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  <span class="kw">var</span> socket;
  <span class="fu">open</span>(<span class="st">&quot;ws://echo.websocket.org&quot;</span>)
    .<span class="fu">then</span>(<span class="kw">function</span>(ws) { socket = ws }) <span class="co">// returns socket as a side-effect</span>
    .<span class="fu">then</span>(<span class="fu">send</span>(<span class="st">&quot;hello, world&quot;</span>))         <span class="co">// and send uses that</span>
    .<span class="fu">then</span>(read)                         <span class="co">// so does read</span>
    .<span class="fu">then</span>(print)
    .<span class="fu">catch</span>(<span class="kw">function</span>(error) {
       <span class="ot">console</span>.<span class="fu">log</span>(<span class="st">&quot;ERROR &quot;</span> + error)
     })
    .<span class="fu">finally</span>(<span class="kw">function</span>() {
       <span class="kw">if</span> (socket) <span class="ot">socket</span>.<span class="fu">close</span>();
     });</code></pre>
</section><section id="when-to-use-promises" class="slide level2">
<h1>When to use promises?</h1>
<ul>
<li class="fragment">Talking to external services (e.g. via AJAX)</li>
<li class="fragment">Local operations that take time (e.g. image loading)</li>
</ul>
</section><section id="image-loading-example" class="slide level2">
<h1>Image loading example</h1>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="fu">getImage</span>(url) {

  <span class="kw">return</span> <span class="kw">new</span> <span class="ot">Q</span>.<span class="fu">Promise</span>(resolve, reject) {
    <span class="kw">var</span> image = <span class="kw">new</span> <span class="fu">Image</span>(url);
    <span class="ot">image</span>.<span class="fu">onload</span> = <span class="kw">function</span>() {
      <span class="fu">resolve</span>(image);
    }
    <span class="ot">image</span>.<span class="fu">onerror</span> = <span class="kw">function</span>(err) {
      <span class="fu">reject</span>(err);
    }
  }
}</code></pre>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  <span class="fu">getImage</span>(<span class="st">&quot;./button.png&quot;</span>).<span class="fu">then</span>(<span class="kw">function</span>(image) { ... });</code></pre>
</section><section id="other-promise-tricks" class="slide level2">
<h1>Other promise tricks</h1>
<ol type="1">
<li><code>promise.all([array of functions])</code> acts like <code>map</code>, runs all concurrently.</li>
<li>Serial actions:</li>
</ol>
<pre class="sourceCode javascript"><code class="sourceCode javascript">  <span class="kw">var</span> messages = [<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;goodbye&quot;</span>];
  <span class="ot">messages</span>.<span class="fu">reduce</span>(
    <span class="kw">function</span>(ws, msg) {
      <span class="ot">ws</span>.<span class="fu">send</span>(message); <span class="kw">return</span> ws
    },
    <span class="fu">open</span>(<span class="st">&quot;ws://echo.websocket.org&quot;</span>)
  )</code></pre>
</section></section>
<section><section id="thank-you" class="titleslide slide level1"><h1>Thank you!</h1></section><section id="making-contact" class="slide level2">
<h1>Making contact</h1>
<p><script type="text/javascript">
<!--
h='&#x6b;&#x61;&#x61;&#122;&#x69;&#110;&#x67;&#46;&#x63;&#x6f;&#x6d;';a='&#64;';n='&#114;&#x69;&#x63;&#104;&#x61;&#114;&#100;&#46;&#x63;&#108;&#x61;&#114;&#x6b;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'">'+e+'<\/'+'a'+'>');
// -->
</script><noscript>&#114;&#x69;&#x63;&#104;&#x61;&#114;&#100;&#46;&#x63;&#108;&#x61;&#114;&#x6b;&#32;&#x61;&#116;&#32;&#x6b;&#x61;&#x61;&#122;&#x69;&#110;&#x67;&#32;&#100;&#x6f;&#116;&#32;&#x63;&#x6f;&#x6d;</noscript> Github/Twitter: <span class="citation" data-cites="rdclark">@rdclark</span></p>
</section></section>
    </div>
  </div>


  <script src="../reveal.js/lib/js/head.min.js"></script>
  <script src="../reveal.js/js/reveal.min.js"></script>

  <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        theme: 'serif', // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: '../reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: '../reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
//          { src: '../reveal.js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; }, }
//          { src: '../reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
]});
    </script>
    </body>
</html>
